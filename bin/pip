#!/usr/bin/env ruby
$:.unshift File.expand_path File.join(File.dirname(__FILE__),'../ruby')
require 'ahp'
require 'ahp_ipc'

AhpHash={}

if AhpIpc.daemon_running?
  STDERR.puts "Already a daemon running..."
  Kernel.exit 
end
AhpIpc.start_daemon!
while ary = AhpIpc.get_command
  cmd,path = *ary
  case cmd.downcase
  when 'pause'
    unless AhpHash[path]
      puts path + " isn't running"
    else
      puts "fake pause " + path
    end
  when 'stop'
    unless AhpHash[path]
      puts path + " isn't running"
    else
      puts "fake stop " + path
    end
  when 'start'
    unless File.exists?(path)
      puts path + " doesn't exist"
    else
      puts "fake start " + path

    end
  end 
  puts [cmd,path].inspect
end
exit
x = Ahp.new ARGV[0]
t = x.run

t.join
