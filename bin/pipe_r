#!/usr/bin/env ruby
history_dir = File.join(ENV['HOME'],'autohistory')
control_path = File.join(history_dir,'control')
STDERR.puts history_dir.inspect
STDERR.puts control_path.inspect
Dir.mkdir(history_dir) unless File.exists?(history_dir)
unless File.exists?(control_path)
  `mkfifo #{control_path}`
end  
unless File.exists?(control_path)
  puts "Totally screwed!"
end


input = open(control_path, "r+") # the r+ means we don't block
while cmd_string = input.gets
  cmd_string=~/^([^:]+):(.*)$/
  cmd,path=$1,$2
  puts [cmd,path].inspect 
end


